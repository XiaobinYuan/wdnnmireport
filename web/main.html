<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    </style>
    <link rel="stylesheet" href="js/dist/bootstrap-table.css">

    <link rel="stylesheet" type="text/css" href="js/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/jstree.min.js"></script>
    <script src="js/highcharts.js"></script>
    <script src="js/exporting.js"></script>
    <script src="js/oldie.js"></script>
    <script src="js/dist/bootstrap-table.js"></script>
    <script src="js/laydate/laydate.js"></script>

</head>
<body>
<select id="time" onchange="changetime();">
    <option value ="-7" selected="selected">过去一周</option>
    <option value ="-30">过去一个月</option>
    <option value="custom">自定义</option>
</select>
<div id="timerange" style="display:none">
    <input type="text" id="test1"  width="300px">    <button onclick="runReport()">运行报表</button>
</div>
<div id="container" style="min-width:400px;height:400px"></div>
<div id="container1" style="min-width:400px;height:400px"></div>
<div id="container2" style="min-width:400px;height:400px"></div>
<div id="container3" style="min-width:400px;height:400px"></div>
<div id="cpu" style="min-width:400px;height:400px">
    <table id="cpu_table" class="table table-hover"></table>
</div>
<div id="avail" style="min-width:400px;height:400px">
    <table id="avail_table" class="table table-hover"></table>
</div>
<div id="allavail" style="min-width:400px;height:400px">
    <table id="allavail_table" class="table table-hover"></table>
</div>
<div id="interfaceavail" style="min-width:400px;height:400px">
    <table id="interfaceavail_table" class="table table-hover"></table>
</div>
<script>
    function hideTimeRange() {
        var timerange=document.getElementById("timerange");
        timerange.style.display="none";
    }
    function compareDate(begintime,endtime) {
        var startTime = new Date(Date.parse(begintime));
        var endTime = new Date(Date.parse(endtime));

        return (startTime>=endTime);
    }
    function runReport() {
        var day=document.getElementById("test1").value;
        var strDate=day.substring(0,10)
        var end=day.substring(12)
        var  today=GetDateStr(0)
        if(compareDate(strDate,today)){
            alert("报告开始日期不能设置为将来!!!");
            return
        }
        if(compareDate(end,today)){
            end=today
        }

        var id = document.getElementById("reportid").value;
        if (id == 1){
            refreshtable(strDate, end,id)
        }
        else if (id == 5){
            chart5(strDate,end,id);
        }else if(id==3){
            refreshtable(strDate,end,id);
        }else if(id==2){
            refreshtable(strDate,end,id);
        }if(id==6){
            broadband(strDate,end,id);
        }if(id==4){
            refreshtable(strDate,end,id);
        }

    }
    function setDefaultTime() {
        $('#time').val(-7)
    }
    function hideother(id) {
        var div1=document.getElementById("container")
        var div2=document.getElementById("container1")
        var div3=document.getElementById("container2")
        var div4=document.getElementById("container3")
        var cpu=document.getElementById("cpu");
        var avail=document.getElementById("avail");
        var allavail=document.getElementById("allavail");
        var interfaceavail=document.getElementById("interfaceavail");


        if(id==1){
            avail.style.display="none";
            div1.style.display="none";
            div2.style.display="none";
            div3.style.display="none";
            div4.style.display="none";
            cpu.style.display="block";
            allavail.style.display="none";
            interfaceavail.style.display="none";


        }else if(id==3){
            cpu.style.display="none";
            allavail.style.display="none";
            avail.style.display="block";
            div1.style.display="none";
            div2.style.display="none";
            div3.style.display="none";
            div4.style.display="none";
            interfaceavail.style.display="none";

        }else  if (id==5||id==6){
            avail.style.display="none";
            allavail.style.display="none";
            div1.style.display="block";
            div2.style.display="block";
            div3.style.display="block";
            div4.style.display="block";
            cpu.style.display="none";
            interfaceavail.style.display="none";

        }else if(id==2){
            cpu.style.display="none";
            allavail.style.display="block";
            avail.style.display="none";
            div1.style.display="none";
            div2.style.display="none";
            div3.style.display="none";
            div4.style.display="none"
            interfaceavail.style.display="none";

        }else if(id==4){
            cpu.style.display="none";
            allavail.style.display="none";
            avail.style.display="none";
            div1.style.display="none";
            div2.style.display="none";
            div3.style.display="none";
            div4.style.display="none"
            interfaceavail.style.display="block";

        }

    }
    function setReportid(id){
        document.getElementById("reportid").value=id;
    }
    function GetDateStr(AddDayCount) {
        var dd = new Date();
        dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期
        var y = dd.getFullYear();
        var m = (dd.getMonth()+1)<10?"0"+(dd.getMonth()+1):(dd.getMonth()+1);//获取当前月份的日期，不足10补0
        var d = dd.getDate()<10?"0"+dd.getDate():dd.getDate();//获取当前几号，不足10补0
        return y+"-"+m+"-"+d;
    }
    function changetime(){
        if(document.getElementById("reportid").value==""||document.getElementById("reportid").value==undefined){
            alert("请先选择报表!");
            return;
        }

        var day=document.getElementById("time").value;
        var timerange=document.getElementById("timerange");

        if(day=="custom"){
            timerange.style.display="block";


            laydate.render({
                elem: '#test1'
                ,range: true
            });

            return;
        }else {
            timerange.style.display="none";
        }
        var strDate = GetDateStr(eval(day));
        var end =  GetDateStr(-0);
        var id = document.getElementById("reportid").value;
        if (id == 1){
            refreshtable(strDate, end,id)
        }
        else if (id == 5){
            chart5(strDate,end,id);
        }else if(id==3){
            refreshtable(strDate,end,id);
        }else if(id==2){
            refreshtable(strDate,end,id);
        }if(id==6){
            broadband(strDate,end,id);
        }if(id==4){
            refreshtable(strDate,end,id);
        }
    }
    function chart5(strDate,end,id){
        hideother(id)
        var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Throughput Out (bps)',
                data: []
            }, {
                name: 'Throughput In (bps)',
                data: []
            }]
        });

        var chart2 = new Highcharts.Chart({
            chart: {
                renderTo: 'container2',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Throughput Out (bps)',
                data: []
            }, {
                name: 'Throughput In (bps)',
                data: []
            }]
        });
        var chart1 = new Highcharts.Chart({
            chart: {
                renderTo: 'container1',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Throughput Out (bps)',
                data: []
            }, {
                name: 'Throughput In (bps)',
                data: []
            }]
        });
        var chart3 = new Highcharts.Chart({
            chart: {
                renderTo: 'container3',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Throughput Out (bps)',
                data: []
            }, {
                name: 'Throughput In (bps)',
                data: []
            }]
        });

        $.get("reportEngine?reportid=5&start="+strDate+"&end="+end+"&reportid"+id, function(data){

            //console.log(data)
            var strs = data.split('#');
            for(var i=0;i<strs.length;i++){
                var json=JSON.parse(strs[i]);//json data  name,time,in,out
                var name=json.data[0].name;
                var time=json.data[1].time
                var thin=json.data[2].thin
                var thout=json.data[3].thout
                var title = {
                    text:""+name
                };
                if(i==0){
                    chart.xAxis[0].setCategories(eval("["+time+"]"));
                    chart.series[0].setData(eval("["+thin+"]"));
                    chart.series[1].setData(eval("["+thout+"]"));
                    chart.setTitle(title);
                }

                if(i==1){
                    chart1.xAxis[0].setCategories(eval("["+time+"]"));
                    chart1.series[0].setData(eval("["+thin+"]"));
                    chart1.series[1].setData(eval("["+thout+"]"));
                    chart1.setTitle(title);
                }
                if(i==2){
                    chart2.xAxis[0].setCategories(eval("["+time+"]"));
                    chart2.series[0].setData(eval("["+thin+"]"));
                    chart2.series[1].setData(eval("["+thout+"]"));
                    chart2.setTitle(title);
                }
                if(i==3){
                    chart3.xAxis[0].setCategories(eval("["+time+"]"));
                    chart3.series[0].setData(eval("["+thin+"]"));
                    chart3.series[1].setData(eval("["+thout+"]"));
                    chart3.setTitle(title);
                }

            }
        });

    }//highchart
    function availTable(strDate, end,reportid) {
        hideother(reportid)
        $('#avail_table').bootstrapTable({
            url: "availtabel?start="+strDate+"&end="+end+"&reportid="+reportid,
            queryParams: "queryParams",
            toolbar: "#toolbar",
            sidePagination: "true",
            striped: true, // 是否显示行间隔色
            search : true,
            uniqueId: "id",
            pageSize: "20",
            pagination: true, // 是否分页
            sortable: true, // 是否启用排序
            columns: [{
                field: 'id',
                title: '节点名'
            },
                {
                    field: 'name',
                    title: '可用性'
                },
            ]
        })
    }
    function allavailTable(strDate, end,reportid) {
        hideother(reportid)
        $('#allavail_table').bootstrapTable({
            url: "allavailtabel?start="+strDate+"&end="+end+"&reportid="+reportid,
            queryParams: "queryParams",
            toolbar: "#toolbar",
            sidePagination: "true",
            striped: true, // 是否显示行间隔色
            search : true,
            uniqueId: "id",
            pageSize: "20",
            pagination: true, // 是否分页
            sortable: true, // 是否启用排序
            columns: [{
                field: 'id',
                title: '节点名'
            },
                {
                    field: 'name',
                    title: '可用性'
                },
            ]
        })
    }
    function InaterfacevailTable(strDate, end,reportid) {
        hideother(reportid)
        $('#interfaceavail_table').bootstrapTable({
            url: "interfaceAail?start="+strDate+"&end="+end+"&reportid="+reportid,
            queryParams: "queryParams",
            toolbar: "#toolbar",
            sidePagination: "true",
            striped: true, // 是否显示行间隔色
            search : true,
            uniqueId: "id",
            pageSize: "20",
            pagination: true, // 是否分页
            sortable: true, // 是否启用排序
            columns: [{
                field: 'id',
                title: '节点名'
            },
                {
                    field: 'name',
                    title: '端口可用性'
                },
            ]
        })
    }
    function cpuMemTable(strDate, end,reportid) {
        $('#cpu_table').bootstrapTable({
            url: "cpumem?start="+strDate+"&end="+end+"&reportid="+reportid,
            queryParams: "queryParams",
            toolbar: "#toolbar",
            sidePagination: "true",
            striped: true, // 是否显示行间隔色
            search : true,
            uniqueId: "host",
            pageSize: "20",
            pagination: true, // 是否分页
            sortable: true, // 是否启用排序
            columns: [{
                field: 'host',
                title: '节点名'
            },
                {
                    field: 'cpu',
                    title: 'CPU%'
                },
                {
                    field: 'mem',
                    title: 'Memory%'
                },
            ]
        })

    }
    function broadband(strDate,end,id){
        hideother(id)
        var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'ThroughputOut (%)',
                data: []
            }, {
                name: 'ThroughputIn (%)',
                data: []
            }]
        });

        var chart2 = new Highcharts.Chart({
            chart: {
                renderTo: 'container2',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'ThroughputOut (%)',
                data: []
            }, {
                name: 'ThroughputIn (%)',
                data: []
            }]
        });
        var chart1 = new Highcharts.Chart({
            chart: {
                renderTo: 'container1',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'ThroughputOut (%)',
                data: []
            }, {
                name: 'ThroughputIn (%)',
                data: []
            }]
        });
        var chart3 = new Highcharts.Chart({
            chart: {
                renderTo: 'container3',
                type: 'line',
                // marginRight: 30,
                // marginBottom: 25
            },
            title: {
                text: "",
                x: -20 //center
            },
            credits: {
                enabled:false
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: [],
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'ThroughputOut (%)',
                data: []
            }, {
                name: 'ThroughputIn (%)',
                data: []
            }]
        });

        $.get("throughputServlet?reportid=5&start="+strDate+"&end="+end+"&reportid"+id, function(data){

            //console.log(data)
            var strs = data.split('#');
            for(var i=0;i<strs.length;i++){
                var json=JSON.parse(strs[i]);//json data  name,time,in,out
                var name=json.data[0].name;
                var time=json.data[1].time
                var thin=json.data[2].thin
                var thout=json.data[3].thout
                var title = {
                    text:""+name
                };
                if(i==0){
                    chart.xAxis[0].setCategories(eval("["+time+"]"));
                    chart.series[0].setData(eval("["+thin+"]"));
                    chart.series[1].setData(eval("["+thout+"]"));
                    chart.setTitle(title);
                }

                if(i==1){
                    chart1.xAxis[0].setCategories(eval("["+time+"]"));
                    chart1.series[0].setData(eval("["+thin+"]"));
                    chart1.series[1].setData(eval("["+thout+"]"));
                    chart1.setTitle(title);
                }
                if(i==2){
                    chart2.xAxis[0].setCategories(eval("["+time+"]"));
                    chart2.series[0].setData(eval("["+thin+"]"));
                    chart2.series[1].setData(eval("["+thout+"]"));
                    chart2.setTitle(title);
                }
                if(i==3){
                    chart3.xAxis[0].setCategories(eval("["+time+"]"));
                    chart3.series[0].setData(eval("["+thin+"]"));
                    chart3.series[1].setData(eval("["+thout+"]"));
                    chart3.setTitle(title);
                }

            }
        });

    }
    function refreshtable(strDate, end,reportid){
        hideother(reportid)

        var urlstr="";
        if(reportid==1){

            urlstr="cpumem?start="+strDate+"&end="+end+"&reportid="+reportid;
        }else if(reportid==3){
            urlstr="availtabel?start="+strDate+"&end="+end+"&reportid="+reportid;

        }else if(reportid==2){

            urlstr= "allavailtabel?start="+strDate+"&end="+end+"&reportid="+reportid;

        }else if(reportid==4){
            urlstr="interfaceAail?start="+strDate+"&end="+end+"&reportid="+reportid;

        }

        $.ajax({
            url: urlstr,
            type: "get",
            dataType : "json",
            data :'data',
            success : function(data){
                if(reportid==1){
                    $('#cpu_table').bootstrapTable({
                        queryParams: "queryParams",
                        toolbar: "#toolbar",
                        sidePagination: "true",
                        striped: true, // 是否显示行间隔色
                        search : true,
                        uniqueId: "host",
                        pageSize: "20",
                        pagination: true, // 是否分页
                        sortable: true, // 是否启用排序
                        columns: [{
                            field: 'host',
                            title: '节点名'
                        },
                            {
                                field: 'cpu',
                                title: 'CPU%'
                            },
                            {
                                field: 'mem',
                                title: 'Memory%'
                            },
                        ]
                    })
                    $("#cpu_table").bootstrapTable('load',data);//刷新ds_table的数据
                }else if(reportid==2){
                    $('#allavail_table').bootstrapTable({
                        // url: "allavailtabel?start="+strDate+"&end="+end+"&reportid="+reportid,
                        queryParams: "queryParams",
                        toolbar: "#toolbar",
                        sidePagination: "true",
                        striped: true, // 是否显示行间隔色
                        search : true,
                        uniqueId: "id",
                        pageSize: "20",
                        pagination: true, // 是否分页
                        sortable: true, // 是否启用排序
                        columns: [{
                            field: 'id',
                            title: '节点名'
                        },
                            {
                                field: 'name',
                                title: '可用性'
                            },
                        ]
                    })
                    $("#allavail_table").bootstrapTable('load',data);//刷新ds_table的数据
                }else if(reportid==3){
                    $('#avail_table').bootstrapTable({
                        // url: "availtabel?start="+strDate+"&end="+end+"&reportid="+reportid,
                        queryParams: "queryParams",
                        toolbar: "#toolbar",
                        sidePagination: "true",
                        striped: true, // 是否显示行间隔色
                        search : true,
                        uniqueId: "id",
                        pageSize: "20",
                        pagination: true, // 是否分页
                        sortable: true, // 是否启用排序
                        columns: [{
                            field: 'id',
                            title: '节点名'
                        },
                            {
                                field: 'name',
                                title: '可用性'
                            },
                        ]
                    })
                    $("#avail_table").bootstrapTable('load',data);//刷新ds_table的数据
                }else if(reportid==4){
                    $('#interfaceavail_table').bootstrapTable({
                        // url: "interfaceAail?start="+strDate+"&end="+end+"&reportid="+reportid,
                        queryParams: "queryParams",
                        toolbar: "#toolbar",
                        sidePagination: "true",
                        striped: true, // 是否显示行间隔色
                        search : true,
                        uniqueId: "id",
                        pageSize: "20",
                        pagination: true, // 是否分页
                        sortable: true, // 是否启用排序
                        columns: [{
                            field: 'id',
                            title: '节点名'
                        },
                            {
                                field: 'name',
                                title: '端口可用性'
                            },
                        ]
                    })
                    $("#interfaceavail_table").bootstrapTable('load',data);//刷新ds_table的数据
                }

            },

            error:function(data){

                alert("查询失败，请联系管理员");

            }
        })
    }

</script>
<input type="hidden" name="reportid" id="reportid" value=""/>
</body>
</html>